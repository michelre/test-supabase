var M=Object.defineProperty,O=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var F=(l,t,a)=>t in l?M(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,I=(l,t)=>{for(var a in t||(t={}))L.call(t,a)&&F(l,a,t[a]);if(k)for(var a of k(t))x.call(t,a)&&F(l,a,t[a]);return l},N=(l,t)=>O(l,z(t));import{c as A,r as b,o as S,a as m,b as p,d as e,w as P,e as U,v as T,f as V,F as g,g as C,t as _,h as D}from"./vendor.ed099d70.js";const E=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const o of d.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerpolicy&&(d.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?d.credentials="include":i.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(i){if(i.ep)return;i.ep=!0;const d=a(i);fetch(i.href,d)}};E();const J="https://ipxugwdennojamrzukzc.supabase.co",q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNDU0MTUzNCwiZXhwIjoxOTUwMTE3NTM0fQ.IHjQizF6OpddzI4jEvWH07ROBVlq5CV9Nizq4UFZJwE",u=A(J,q);var B=(l,t)=>{for(const[a,n]of t)l[a]=n;return l};const K={setup(){const l=b([]),t=b([]),a=b({name:"",owner:null}),n=async()=>{let{data:s,error:r,status:c}=await u.from("project").select("id, name, profile ( first_name, last_name ), document (id, object_id)");!r&&c===200&&(l.value=s)},i=async()=>{let{data:s,error:r,status:c}=await u.from("profile").select("id, first_name, last_name )");!r&&c===200&&(t.value=s)},d=async()=>{const{data:s,error:r}=await u.from("project").insert(a.value);if(r){console.log(r);return}n()},o=async s=>{const{data:r}=await u.from("document").select("*").match({project_id:s});for(let w in r)await f(s,r[w]);const{data:c,error:y}=await u.from("project").delete().match({id:s});y||n()},h=async(s,r)=>{const c=s.target.files[0],{data:y,error:w}=await u.storage.from("project-files").upload(`${r}/${c.name}`,c,{cacheControl:"3600",upsert:!1});w||(await u.from("document").insert({object_id:y.Key.replace("project-files/",""),project_id:r}),s.target.value=""),v(r)},j=async s=>{const{data:r,error:c}=await u.storage.from("project-files").createSignedUrl(s,60*60);c||window.open(r.signedURL)},f=async(s,r)=>{const{error:c}=await u.storage.from("project-files").remove([r.object_id]);c||(await u.from("document").delete().match({id:r.id}),v(s))},v=async s=>{const{data:r}=await u.from("document").select("*").eq("project_id",s);l.value=l.value.map(c=>c.id===s?N(I({},c),{document:r}):c)};return S(()=>{n(),i()}),{projects:l,owners:t,project:a,addProject:d,deleteProject:o,uploadFile:h,downloadFile:j,deleteFile:f}}},R=e("h2",null,"Ajouter un projet",-1),X=e("label",null," Nom du projet ",-1),H=e("label",null," Propri\xE9taire du projet ",-1),Q=["value"],W=e("button",{type:"submit"},"Ajouter le projet",-1),Y=e("h2",null,"Liste des projets",-1),Z=e("thead",null,[e("tr",null,[e("th",null,"Nom"),e("th",null,"Porteur"),e("th",null,"Documents"),e("th")])],-1),G=["onClick"],$=["onClick"],ee=["onChange"],te=["onClick"];function oe(l,t,a,n,i,d){return m(),p("div",null,[e("section",null,[R,e("form",{onSubmit:t[2]||(t[2]=P((...o)=>n.addProject&&n.addProject(...o),["prevent"]))},[e("div",null,[X,U(e("input",{placeholder:"name","onUpdate:modelValue":t[0]||(t[0]=o=>n.project.name=o)},null,512),[[T,n.project.name]])]),e("div",null,[H,U(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.project.owner=o)},[(m(!0),p(g,null,C(n.owners,o=>(m(),p("option",{value:o.id},_(o.first_name)+" "+_(o.last_name),9,Q))),256))],512),[[V,n.project.owner]])]),W],32)]),e("section",null,[Y,e("table",null,[Z,e("tbody",null,[(m(!0),p(g,null,C(n.projects,o=>{var h,j;return m(),p("tr",null,[e("td",null,_(o.name),1),e("td",null,_((h=o.profile)==null?void 0:h.first_name)+" "+_((j=o.profile)==null?void 0:j.last_name),1),e("td",null,[e("ul",null,[(m(!0),p(g,null,C(o.document,f=>(m(),p("li",null,[e("a",{href:"",onClick:P(v=>n.downloadFile(f.object_id),["prevent"])},_(f.object_id),9,G),e("button",{onClick:v=>n.deleteFile(o.id,f)},"X",8,$)]))),256))]),e("input",{type:"file",onChange:f=>n.uploadFile(f,o.id)},null,40,ee)]),e("td",null,[e("button",{onClick:f=>n.deleteProject(o.id)},"Supprimer",8,te)])])}),256))])])])])}var ne=B(K,[["render",oe]]);D(ne).mount("#app");
