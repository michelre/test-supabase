var L=Object.defineProperty,x=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var P=(l,e,i)=>e in l?L(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i,M=(l,e)=>{for(var i in e||(e={}))S.call(e,i)&&P(l,i,e[i]);if(N)for(var i of N(e))T.call(e,i)&&P(l,i,e[i]);return l},O=(l,e)=>x(l,V(e));import{c as D,r as h,o as E,a as m,b as f,d as t,w as U,v as z,F as j,e as w,f as A,g as J,t as _,h as q}from"./vendor.7da38c5a.js";const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=i(s);fetch(s.href,c)}};B();const K="https://ipxugwdennojamrzukzc.supabase.co",R="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNDU0MTUzNCwiZXhwIjoxOTUwMTE3NTM0fQ.IHjQizF6OpddzI4jEvWH07ROBVlq5CV9Nizq4UFZJwE",u=D(K,R);var X=(l,e)=>{for(const[i,n]of e)l[i]=n;return l};const H={setup(){const l=h([]),e=h([]),i=h(["remi38180@yopmail.com","remi38181@yopmail.com","remi@yopmail.com"]),n=h({name:"",owner:null}),s=h("remi38180@yopmail.com"),c=async()=>{let{data:a,error:r,status:d}=await u.from("project").select("id, name");!r&&d===200&&(l.value=a)},o=async()=>{let{data:a,error:r,status:d}=await u.from("profile").select("id, first_name, last_name )");!r&&d===200&&(e.value=a)},v=async()=>{const{data:a,error:r}=await u.from("project").insert(n.value);if(r){console.log(r);return}c()},y=async a=>{const{data:r}=await u.from("document").select("*").match({project_id:a});for(let C in r)await k(a,r[C]);const{data:d,error:b}=await u.from("project").delete().match({id:a});b||c()},p=async(a,r)=>{const d=a.target.files[0],{data:b,error:C}=await u.storage.from("project-files").upload(`${r}/${d.name}`,d,{cacheControl:"3600",upsert:!1});C||(await u.from("document").insert({object_id:b.Key.replace("project-files/",""),project_id:r}),a.target.value=""),I(r)},g=async a=>{const{data:r,error:d}=await u.storage.from("project-files").createSignedUrl(a,60*60);d||window.open(r.signedURL)},k=async(a,r)=>{const{error:d}=await u.storage.from("project-files").remove([r.object_id]);d||(await u.from("document").delete().match({id:r.id}),I(a))},I=async a=>{const{data:r}=await u.from("document").select("*").eq("project_id",a);l.value=l.value.map(d=>d.id===a?O(M({},d),{document:r}):d)},F=async()=>{l.value=[];let{session:a,error:r}=await u.auth.signIn({email:s.value,password:"rwigo123"});r&&alert("error"),r||(u.auth.setAuth(a.access_token),c())};return E(()=>{c(),o(),F()}),{projects:l,owners:e,project:n,users:i,user:s,addProject:v,deleteProject:y,uploadFile:p,downloadFile:g,deleteFile:k,changeUser:F}}},Q=["value"],W=t("h2",null,"Ajouter un projet",-1),Y=t("label",null," Nom du projet ",-1),Z=t("label",null," Propri\xE9taire du projet ",-1),G=["value"],$=t("button",{type:"submit"},"Ajouter le projet",-1),ee=t("h2",null,"Liste des projets",-1),te=t("thead",null,[t("tr",null,[t("th",null,"Nom"),t("th",null,"Porteur"),t("th",null,"Documents"),t("th")])],-1),oe=["onClick"],ne=["onClick"],re=["onChange"],le=["onClick"];function ae(l,e,i,n,s,c){return m(),f("div",null,[t("section",null,[U(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.user=o),onChange:e[1]||(e[1]=(...o)=>n.changeUser&&n.changeUser(...o))},[(m(!0),f(j,null,w(n.users,o=>(m(),f("option",{value:o},_(o),9,Q))),256))],544),[[z,n.user]])]),t("section",null,[W,t("form",{onSubmit:e[4]||(e[4]=A((...o)=>n.addProject&&n.addProject(...o),["prevent"]))},[t("div",null,[Y,U(t("input",{placeholder:"name","onUpdate:modelValue":e[2]||(e[2]=o=>n.project.name=o)},null,512),[[J,n.project.name]])]),t("div",null,[Z,U(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.project.owner=o)},[(m(!0),f(j,null,w(n.owners,o=>(m(),f("option",{value:o.id},_(o.first_name)+" "+_(o.last_name),9,G))),256))],512),[[z,n.project.owner]])]),$],32)]),t("section",null,[ee,t("table",null,[te,t("tbody",null,[(m(!0),f(j,null,w(n.projects,o=>{var v,y;return m(),f("tr",null,[t("td",null,_(o.name),1),t("td",null,_((v=o.profile)==null?void 0:v.first_name)+" "+_((y=o.profile)==null?void 0:y.last_name),1),t("td",null,[t("ul",null,[(m(!0),f(j,null,w(o.document,p=>(m(),f("li",null,[t("a",{href:"",onClick:A(g=>n.downloadFile(p.object_id),["prevent"])},_(p.object_id),9,oe),t("button",{onClick:g=>n.deleteFile(o.id,p)},"X",8,ne)]))),256))]),t("input",{type:"file",onChange:p=>n.uploadFile(p,o.id)},null,40,re)]),t("td",null,[t("button",{onClick:p=>n.deleteProject(o.id)},"Supprimer",8,le)])])}),256))])])])])}var se=X(H,[["render",ae]]);q(se).mount("#app");
